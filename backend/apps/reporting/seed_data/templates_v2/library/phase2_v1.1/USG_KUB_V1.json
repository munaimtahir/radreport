{
  "code": "USG_KUB_V1",
  "name": "USG KUB",
  "modality": "USG",
  "status": "active",
  "is_frozen": false,
  "json_schema": {
    "type": "object",
    "properties": {
      "kid_r_length_cm": {"type": "number"},
      "kid_l_length_cm": {"type": "number"},
      "kid_r_hydronephrosis_grade": {"type": "string"},
      "kid_l_hydronephrosis_grade": {"type": "string"},
      "kid_r_calculus_present": {"type": "boolean"},
      "kid_l_calculus_present": {"type": "boolean"},
      "ure_r_stone_suspected": {"type": "boolean"},
      "ure_l_stone_suspected": {"type": "boolean"},
      "bl_stone_present": {"type": "boolean"},
      "bl_mass_suspected": {"type": "boolean"},
      "bl_pvr_ml": {"type": "number"}
    }
  },
  "ui_schema": {
    "ui:order": [
      "kid_r_length_cm",
      "kid_l_length_cm",
      "kid_r_hydronephrosis_grade",
      "kid_l_hydronephrosis_grade",
      "kid_r_calculus_present",
      "kid_l_calculus_present",
      "ure_r_stone_suspected",
      "ure_l_stone_suspected",
      "bl_stone_present",
      "bl_mass_suspected",
      "bl_pvr_ml"
    ]
  },
  "narrative_rules": {
    "sections": [
      {
        "title": "Kidneys / Ureters / Bladder",
        "content": [
          {"if": {"field": "kid_r_length_cm", "gte": 0}, "then": "Right kidney measures {{kid_r_length_cm}} cm."},
          {"if": {"field": "kid_l_length_cm", "gte": 0}, "then": "Left kidney measures {{kid_l_length_cm}} cm."},
          {"if": {"field": "kid_r_calculus_present", "equals": true}, "then": "Right renal calculus is identified."},
          {"if": {"field": "kid_l_calculus_present", "equals": true}, "then": "Left renal calculus is identified."},
          {"if": {"field": "ure_r_stone_suspected", "equals": true}, "then": "Right ureteric calculus is suspected."},
          {"if": {"field": "ure_l_stone_suspected", "equals": true}, "then": "Left ureteric calculus is suspected."},
          {"if": {"field": "bl_stone_present", "equals": true}, "then": "Vesical calculus is present."}
        ]
      }
    ],
    "impression_rules": [
      {"priority": 10, "when": {"field": "kid_r_hydronephrosis_grade", "not_equals": "none"}, "text": "Right hydronephrosis.", "continue": true},
      {"priority": 11, "when": {"field": "kid_l_hydronephrosis_grade", "not_equals": "none"}, "text": "Left hydronephrosis.", "continue": true},
      {"priority": 20, "when": {"field": "bl_mass_suspected", "equals": true}, "text": "Suspicious bladder lesion.", "continue": true},
      {"priority": 30, "when": {"field": "bl_pvr_ml", "gte": 100}, "text": "Significant post-void residual urine.", "continue": true}
    ]
  }
}
