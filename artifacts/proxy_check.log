{
	email munaim.tahir@gmail.com

	log {
		output file /home/munaim/srv/proxy/caddy/logs/caddy.log
		format console
	}
}

# ============================================================
# FMU-PLATFORM (SIMS)
# Frontend: sims.*, lims.*  -> 127.0.0.1:8080
# Backend:  api.sims.*, api.lims.* -> 127.0.0.1:8010
# ============================================================

sims.alshifalab.pk, sims.pmc.edu.pk {
	encode gzip zstd

	# API routes to backend
	handle /api/* {
		reverse_proxy 127.0.0.1:8010 {
			header_up Host {host}
			header_up X-Real-IP {remote}
			header_up X-Forwarded-For {remote}
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-Host {host}
		}
	}

	# Admin routes to backend
	handle /admin/* {
		reverse_proxy 127.0.0.1:8010 {
			header_up Host {host}
			header_up X-Real-IP {remote}
			header_up X-Forwarded-For {remote}
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-Host {host}
		}
	}

	# All other requests (Frontend)
	handle {
		reverse_proxy 127.0.0.1:8080 {
			header_up Host {host}
			header_up X-Real-IP {remote}
			header_up X-Forwarded-For {remote}
			header_up X-Forwarded-Proto {scheme}
		}
	}
}

api.sims.alshifalab.pk, api.sims.pmc.edu.pk {

	encode gzip zstd

	reverse_proxy 127.0.0.1:8010 {

		header_up Host {host}

		header_up X-Real-IP {remote_host}

		header_up X-Forwarded-For {remote_host}

		header_up X-Forwarded-Proto {scheme}

		header_up X-Forwarded-Host {host}

	}

}

# ============================================================
# LIMS (Laboratory Information Management System)
# Standalone LIMS application
# Frontend & Backend: lims.alshifalab.pk -> 127.0.0.1:8012
# ============================================================

lims.alshifalab.pk {
	encode gzip zstd

	# Security headers
	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		X-Frame-Options "SAMEORIGIN"
		X-Content-Type-Options "nosniff"
		Referrer-Policy "strict-origin-when-cross-origin"
		-Server
	}

	# Proxy all requests to LIMS Docker container
	reverse_proxy 127.0.0.1:8012 {
		header_up Host {host}
		header_up X-Real-IP {remote}
		header_up X-Forwarded-For {remote}
		header_up X-Forwarded-Proto {scheme}
		header_up X-Forwarded-Host {host}
	}
}

api.lims.alshifalab.pk {
	encode gzip zstd
	reverse_proxy 127.0.0.1:8012 {
		header_up Host {host}
		header_up X-Real-IP {remote_host}
		header_up X-Forwarded-For {remote_host}
		header_up X-Forwarded-Proto {scheme}
		header_up X-Forwarded-Host {host}
	}
}



# ============================================================
# PGSIMS
# Frontend: pgsims.* -> 127.0.0.1:8082
# Backend:  api.pgsims.* -> 127.0.0.1:8014
# ============================================================

pgsims.alshifalab.pk, pgsims.pmc.edu.pk {
	encode gzip zstd

	# Security headers
	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		X-Frame-Options "SAMEORIGIN"
		X-Content-Type-Options "nosniff"
		Referrer-Policy "strict-origin-when-cross-origin"
		-Server
	}

	# Health check endpoint
	handle /healthz* {
		reverse_proxy 127.0.0.1:8014 {
			header_up Host {host}
			header_up X-Real-IP {remote}
			header_up X-Forwarded-For {remote}
			header_up X-Forwarded-Proto {scheme}
		}
	}

	# Static files
	handle /static/* {
		root * /home/munaim/srv/apps/pgsims/staticfiles
		file_server
		header Cache-Control "public, max-age=31536000, immutable"
	}

	# Media files
	handle /media/* {
		root * /home/munaim/srv/apps/pgsims/media
		file_server
		header Cache-Control "public, max-age=604800"
	}

	# API endpoints
	handle /api/* {
		reverse_proxy 127.0.0.1:8014 {
			header_up Host {host}
			header_up X-Real-IP {remote}
			header_up X-Forwarded-For {remote}
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-Host {host}
		}
	}

	# Admin routes
	handle /admin/* {
		reverse_proxy 127.0.0.1:8014 {
			header_up Host {host}
			header_up X-Real-IP {remote}
			header_up X-Forwarded-For {remote}
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-Host {host}
		}
	}

	# All other requests (Frontend Next.js)
	handle {
		reverse_proxy 127.0.0.1:8082 {
			header_up Host {host}
			header_up X-Real-IP {remote}
			header_up X-Forwarded-For {remote}
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-Host {host}
			
			transport http {
				dial_timeout 10s
				response_header_timeout 60s
			}
		}
	}
}




# ============================================================
# RADREPORT / RIMS
# Frontend: rims.* -> 127.0.0.1:8081
# Backend:  api.rims.* -> 127.0.0.1:8015
# ============================================================

rims.alshifalab.pk {
	encode gzip zstd

	# API routes to backend
	handle /api/* {
		reverse_proxy 127.0.0.1:8015 {
			header_up Host {host}
			header_up X-Real-IP {remote}
			header_up X-Forwarded-For {remote}
			header_up X-Forwarded-Proto {scheme}
			header_up X-Forwarded-Host {host}
		}
	}

	# All other requests (Frontend)
	handle {
		reverse_proxy 127.0.0.1:8081 {
			header_up Host {host}
			header_up X-Real-IP {remote}
			header_up X-Forwarded-For {remote}
			header_up X-Forwarded-Proto {scheme}
		}
	}
}

api.rims.alshifalab.pk {
	encode gzip zstd
	reverse_proxy 127.0.0.1:8015 {
		header_up Host {host}
		header_up X-Real-IP {remote_host}
		header_up X-Forwarded-For {remote_host}
		header_up X-Forwarded-Proto {scheme}
		header_up X-Forwarded-Host {host}
	}
}

# ============================================================
# CONSULT / REFERRAL SYSTEM
# Frontend: consult.* -> backend-served UI
# Backend:  api.consult.* -> 127.0.0.1:8011
# ============================================================

consult.alshifalab.pk {
	encode gzip zstd
	reverse_proxy 127.0.0.1:8011
}

api.consult.alshifalab.pk {
	encode gzip zstd
	reverse_proxy 127.0.0.1:8011 {
		header_up Host {host}
		header_up X-Real-IP {remote_host}
		header_up X-Forwarded-For {remote_host}
		header_up X-Forwarded-Proto {scheme}
		header_up X-Forwarded-Host {host}
	}
}

# ============================================================
# ACCRED-AI / PHC
# Frontend: phc.* -> backend-served UI
# Backend:  api.phc.* -> 127.0.0.1:8016
# ============================================================

phc.alshifalab.pk {
	encode gzip zstd
	reverse_proxy 127.0.0.1:8016
}

api.phc.alshifalab.pk {
	encode gzip zstd
	reverse_proxy 127.0.0.1:8016 {
		header_up Host {host}
		header_up X-Real-IP {remote_host}
		header_up X-Forwarded-For {remote_host}
		header_up X-Forwarded-Proto {scheme}
		header_up X-Forwarded-Host {host}
	}
}

# ============================================================
# PORTAL (separate service)
# Frontend: portal.* -> 127.0.0.1:8013
# ============================================================

portal.alshifalab.pk {
	encode gzip zstd
	reverse_proxy 127.0.0.1:8013
}

# IP redirect for PGSIMS
34.16.82.13 {
	redir https://pgsims.alshifalab.pk{uri} permanent
}
HTTP/1.1 200 OK
date: Thu, 29 Jan 2026 09:30:56 GMT
server: envoy

HTTP/1.1 200 OK
accept-ranges: bytes
alt-svc: h3=":443"; ma=2592000
content-type: text/html
date: Thu, 29 Jan 2026 09:30:57 GMT
etag: "697b21e3-190"
last-modified: Thu, 29 Jan 2026 09:01:23 GMT
server: envoy
via: 1.1 Caddy
x-content-type-options: nosniff
x-frame-options: SAMEORIGIN
content-length: 400
x-envoy-upstream-service-time: 85

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Consultants Place Clinic</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <script type="module" crossorigin src="/assets/index-BLZCtdX4.js"></script>
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
total 24K
drwxr-xr-x 4 root root 4.0K Jan 29 09:32 .
drwxr-xr-x 6 root root 4.0K Jan 29 09:32 ..
drwxr-xr-x 2 root root 4.0K Jan 29 09:32 assets
drwxr-xr-x 2 root root 4.0K Jan 29 09:32 brand
-rw-r--r-- 1 root root  447 Jan 29 09:32 favicon.svg
-rw-r--r-- 1 root root  400 Jan 29 09:32 index.html
frontend/dist/index.html
frontend/dist/assets
HTTP/1.1 200 OK
date: Thu, 29 Jan 2026 09:32:54 GMT
server: envoy

HTTP/1.1 200 OK
accept-ranges: bytes
alt-svc: h3=":443"; ma=2592000
content-type: text/html
date: Thu, 29 Jan 2026 09:32:55 GMT
etag: "697b21e3-190"
last-modified: Thu, 29 Jan 2026 09:01:23 GMT
server: envoy
via: 1.1 Caddy
x-content-type-options: nosniff
x-frame-options: SAMEORIGIN
content-length: 400
x-envoy-upstream-service-time: 76

