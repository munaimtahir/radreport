Starting V2 template import
Templates source: /workspace/radreport/backend/apps/reporting/seed_data/templates_v2
Mappings source:  /workspace/radreport/backend/apps/reporting/seed_data/templates_v2/service_template_map.csv
DRY RUN MODE: no changes will be persisted.
Operations to perform:
  Apply all migrations: admin, audit, auth, authtoken, catalog, consultants, contenttypes, patients, reporting, sessions, studies, workflow
Running migrations:
  Applying contenttypes.0001_initial... OK
  Applying auth.0001_initial... OK
  Applying admin.0001_initial... OK
  Applying admin.0002_logentry_remove_auto_add... OK
  Applying admin.0003_logentry_add_action_flag_choices... OK
  Applying audit.0001_initial... OK
  Applying contenttypes.0002_remove_content_type_name... OK
  Applying auth.0002_alter_permission_name_max_length... OK
  Applying auth.0003_alter_user_email_max_length... OK
  Applying auth.0004_alter_user_username_opts... OK
  Applying auth.0005_alter_user_last_login_null... OK
  Applying auth.0006_require_contenttypes_0002... OK
  Applying auth.0007_alter_validators_add_error_messages... OK
  Applying auth.0008_alter_user_username_max_length... OK
  Applying auth.0009_alter_user_last_name_max_length... OK
  Applying auth.0010_alter_group_name_max_length... OK
  Applying auth.0011_update_proxy_permissions... OK
  Applying auth.0012_alter_user_first_name_max_length... OK
  Applying authtoken.0001_initial... OK
  Applying authtoken.0002_auto_20160226_1747... OK
  Applying authtoken.0003_tokenproxy... OK
  Applying authtoken.0004_alter_tokenproxy_options... OK
  Applying catalog.0001_initial... OK
  Applying catalog.0002_service_category_service_charges_service_code_and_more... OK
  Applying catalog.0003_service_default_price_turnaround_time... OK
  Applying patients.0001_initial... OK
  Applying patients.0002_patient_date_of_birth_alter_patient_mrn... OK
  Applying workflow.0001_initial... OK
  Applying workflow.0004_phase_b_c_combined... OK
  Applying workflow.0005_phase_d_canonical_usg_report... OK
  Applying workflow.0006_migrate_service_catalog_to_catalog_service... OK
  Applying consultants.0001_initial... OK
  Applying consultants.0002_consultantbillingrule_service_and_more... OK
  Applying consultants.0003_consultantbillingrule_consultant_fixed_amount_and_more... OK
  Applying patients.0003_patient_patient_reg_no... OK
  Applying patients.0004_rename_patients_pa_patient_idx_patients_pa_patient_42dea5_idx... OK
  Applying workflow.0007_receipt_snapshot... OK
  Applying workflow.0008_alter_servicecatalog_options_and_more... OK
  Applying workflow.0009_alter_usgreport_scan_quality... OK
  Applying workflow.0010_delete_usgreport... OK
  Applying workflow.0011_servicevisit_referring_consultant... OK
  Applying workflow.0012_receiptsnapshot_referring_consultant... OK
  Applying reporting.0001_initial... OK
  Applying reporting.0002_reportinstance_findings_text_and_more... OK
  Applying reporting.0003_reportactionlog_reportpublishsnapshot... OK
  Applying reporting.0004_reportingorganizationconfig_and_more... OK
  Applying reporting.0005_alter_reportvalue_unique_together_and_more... OK
  Applying reporting.0006_alter_reportparameter_unique_together... OK
  Applying reporting.0007_template_governance... OK
  Applying reporting.0008_reporting_v2_models... OK
  Applying reporting.0009_add_v2_publish_snapshot_and_narrative_rules... OK
  Applying reporting.0010_rename_reporting_r_report__b8e9b5_idx_reporting_r_report__9d129f_idx_and_more... OK
  Applying reporting.0011_reporttemplatev2_is_frozen_reportactionlogv2... OK
  Applying reporting.0012_reportinstancev2_narrative_json... OK
  Applying reporting.0013_reportblocklibrary... OK
  Applying reporting.0014_remove_legacy_reporting... OK
  Applying sessions.0001_initial... OK
  Applying studies.0001_initial... OK
  Applying studies.0002_orderitem_study_order_item_visit_orderitem_visit_and_more... OK
  Applying studies.0003_receiptsequence_receiptsettings_and_more... OK
  Applying studies.0004_receiptsettings_footer_text... OK
  Applying studies.0005_backfill_receipt_settings... OK
  Applying studies.0006_alter_receiptsettings_footer_text_and_more... OK
Starting V2 template import
Templates source: /workspace/radreport/backend/apps/reporting/seed_data/templates_v2
Mappings source:  /workspace/radreport/backend/apps/reporting/seed_data/templates_v2/service_template_map.csv
DRY RUN MODE: no changes will be persisted.

--------- SUMMARY ---------
Templates Created: 18
Templates Updated: 0
Mappings Created:  0
Mappings Updated:  0
Unresolved services (3):
 - Service not found: 'USG-ABD'
 - Service not found: 'USG-KUB'
 - Service not found: 'USG-PELVIS'
---------------------------
Starting V2 template import
Templates source: /workspace/radreport/backend/apps/reporting/seed_data/templates_v2
Mappings source:  /workspace/radreport/backend/apps/reporting/seed_data/templates_v2/service_template_map.csv

--------- SUMMARY ---------
Templates Created: 18
Templates Updated: 0
Mappings Created:  0
Mappings Updated:  0
Unresolved services (3):
 - Service not found: 'USG-ABD'
 - Service not found: 'USG-KUB'
 - Service not found: 'USG-PELVIS'
---------------------------

no tests ran in 0.00s

==================================== ERRORS ====================================
___________ ERROR collecting apps/reporting/tests/test_v2_import.py ____________
apps/reporting/tests/test_v2_import.py:9: in <module>
    from apps.catalog.models import Modality, Service
apps/catalog/models.py:4: in <module>
    class Modality(models.Model):
/root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/db/models/base.py:131: in __new__
    app_config = apps.get_containing_app_config(module)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/apps/registry.py:260: in get_containing_app_config
    self.check_apps_ready()
/root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/apps/registry.py:138: in check_apps_ready
    raise AppRegistryNotReady("Apps aren't loaded yet.")
E   django.core.exceptions.AppRegistryNotReady: Apps aren't loaded yet.
____ ERROR collecting apps/reporting/tests/test_workitem_v2_minimal_flow.py ____
apps/reporting/tests/test_workitem_v2_minimal_flow.py:2: in <module>
    from django.contrib.auth.models import Group
/root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/contrib/auth/models.py:5: in <module>
    from django.contrib.auth.base_user import AbstractBaseUser, BaseUserManager
/root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/contrib/auth/base_user.py:43: in <module>
    class AbstractBaseUser(models.Model):
/root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/db/models/base.py:131: in __new__
    app_config = apps.get_containing_app_config(module)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/apps/registry.py:260: in get_containing_app_config
    self.check_apps_ready()
/root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/apps/registry.py:138: in check_apps_ready
    raise AppRegistryNotReady("Apps aren't loaded yet.")
E   django.core.exceptions.AppRegistryNotReady: Apps aren't loaded yet.
=========================== short test summary info ============================
ERROR apps/reporting/tests/test_v2_import.py - django.core.exceptions.AppRegi...
ERROR apps/reporting/tests/test_workitem_v2_minimal_flow.py - django.core.exc...
!!!!!!!!!!!!!!!!!!! Interrupted: 2 errors during collection !!!!!!!!!!!!!!!!!!!!
2 errors in 0.81s
.F...F                                                                   [100%]
=================================== FAILURES ===================================
______ V2TemplateImportTests.test_import_command_dry_run_makes_no_writes _______

self = <apps.reporting.tests.test_v2_import.V2TemplateImportTests testMethod=test_import_command_dry_run_makes_no_writes>

    def test_import_command_dry_run_makes_no_writes(self):
        call_command("import_templates_v2", "--dry-run")
>       self.assertEqual(ReportTemplateV2.objects.count(), 0)
E       AssertionError: 18 != 0

apps/reporting/tests/test_v2_import.py:38: AssertionError
----------------------------- Captured stdout call -----------------------------
Starting V2 template import
Templates source: /workspace/radreport/backend/apps/reporting/seed_data/templates_v2
Mappings source:  /workspace/radreport/backend/apps/reporting/seed_data/templates_v2/service_template_map.csv
DRY RUN MODE: no changes will be persisted.

--------- SUMMARY ---------
Templates Created: 0
Templates Updated: 18
Mappings Created:  1
Mappings Updated:  0
Unresolved services (2):
 - Service not found: 'USG-KUB'. closest=USG Abdomen
 - Service not found: 'USG-PELVIS'
---------------------------
___________________ WorkItemV2MinimalFlowTests.test_v2_flow ____________________

self = <apps.reporting.tests.test_workitem_v2_minimal_flow.WorkItemV2MinimalFlowTests testMethod=test_v2_flow>

    def test_v2_flow(self):
        self.client.force_authenticate(self.user)
        base = f"/api/reporting/workitems/{self.item.id}/"
    
        schema_resp = self.client.get(base + "schema/")
>       self.assertEqual(schema_resp.status_code, 200)
E       AssertionError: 400 != 200

apps/reporting/tests/test_workitem_v2_minimal_flow.py:48: AssertionError
----------------------------- Captured stderr call -----------------------------
2026-02-06 01:06:24,127 ERROR django.security.DisallowedHost Invalid HTTP_HOST header: 'testserver'. You may need to add 'testserver' to ALLOWED_HOSTS.
Traceback (most recent call last):
  File "/root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/core/handlers/exception.py", line 55, in inner
    response = get_response(request)
               ^^^^^^^^^^^^^^^^^^^^^
  File "/root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/utils/deprecation.py", line 119, in __call__
    response = self.process_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/middleware/common.py", line 48, in process_request
    host = request.get_host()
           ^^^^^^^^^^^^^^^^^^
  File "/root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/http/request.py", line 202, in get_host
    raise DisallowedHost(msg)
django.core.exceptions.DisallowedHost: Invalid HTTP_HOST header: 'testserver'. You may need to add 'testserver' to ALLOWED_HOSTS.
------------------------------ Captured log call -------------------------------
ERROR    django.security.DisallowedHost:log.py:253 Invalid HTTP_HOST header: 'testserver'. You may need to add 'testserver' to ALLOWED_HOSTS.
Traceback (most recent call last):
  File "/root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/core/handlers/exception.py", line 55, in inner
    response = get_response(request)
               ^^^^^^^^^^^^^^^^^^^^^
  File "/root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/utils/deprecation.py", line 119, in __call__
    response = self.process_request(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/middleware/common.py", line 48, in process_request
    host = request.get_host()
           ^^^^^^^^^^^^^^^^^^
  File "/root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/http/request.py", line 202, in get_host
    raise DisallowedHost(msg)
django.core.exceptions.DisallowedHost: Invalid HTTP_HOST header: 'testserver'. You may need to add 'testserver' to ALLOWED_HOSTS.
=============================== warnings summary ===============================
apps/reporting/tests/test_workitem_v2_minimal_flow.py::WorkItemV2MinimalFlowTests::test_v2_flow
  /root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/core/handlers/base.py:61: UserWarning: No directory at: /workspace/radreport/backend/staticfiles/
    mw_instance = middleware(adapted_handler)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED apps/reporting/tests/test_v2_import.py::V2TemplateImportTests::test_import_command_dry_run_makes_no_writes
FAILED apps/reporting/tests/test_workitem_v2_minimal_flow.py::WorkItemV2MinimalFlowTests::test_v2_flow
2 failed, 4 passed, 1 warning in 3.25s
.F....                                                                   [100%]
=================================== FAILURES ===================================
______ V2TemplateImportTests.test_import_command_dry_run_makes_no_writes _______

self = <apps.reporting.tests.test_v2_import.V2TemplateImportTests testMethod=test_import_command_dry_run_makes_no_writes>

    def test_import_command_dry_run_makes_no_writes(self):
        call_command("import_templates_v2", "--dry-run")
>       self.assertEqual(ReportTemplateV2.objects.count(), 0)
E       AssertionError: 18 != 0

apps/reporting/tests/test_v2_import.py:38: AssertionError
----------------------------- Captured stdout call -----------------------------
Starting V2 template import
Templates source: /workspace/radreport/backend/apps/reporting/seed_data/templates_v2
Mappings source:  /workspace/radreport/backend/apps/reporting/seed_data/templates_v2/service_template_map.csv
DRY RUN MODE: no changes will be persisted.

--------- SUMMARY ---------
Templates Created: 0
Templates Updated: 18
Mappings Created:  1
Mappings Updated:  0
Unresolved services (2):
 - Service not found: 'USG-KUB'. closest=USG Abdomen
 - Service not found: 'USG-PELVIS'
---------------------------
=============================== warnings summary ===============================
apps/reporting/tests/test_workitem_v2_minimal_flow.py::WorkItemV2MinimalFlowTests::test_v2_flow
  /root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/core/handlers/base.py:61: UserWarning: No directory at: /workspace/radreport/backend/staticfiles/
    mw_instance = middleware(adapted_handler)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED apps/reporting/tests/test_v2_import.py::V2TemplateImportTests::test_import_command_dry_run_makes_no_writes
1 failed, 5 passed, 1 warning in 4.10s
......                                                                   [100%]
=============================== warnings summary ===============================
apps/reporting/tests/test_workitem_v2_minimal_flow.py::WorkItemV2MinimalFlowTests::test_v2_flow
  /root/.pyenv/versions/3.12.12/lib/python3.12/site-packages/django/core/handlers/base.py:61: UserWarning: No directory at: /workspace/radreport/backend/staticfiles/
    mw_instance = middleware(adapted_handler)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
6 passed, 1 warning in 3.76s
GET /api/health/ -> 200
GET /api/reporting/workitems/00000000-0000-0000-0000-000000000000/schema/ -> 401

> rims-frontend@0.1.0 test
> vitest --run src/utils/reporting/__tests__/errors.test.ts


 RUN  v4.0.17 /workspace/radreport/frontend

 âœ“ src/utils/reporting/__tests__/errors.test.ts (2 tests) 5ms

 Test Files  1 passed (1)
      Tests  2 passed (2)
   Start at  20:07:20
   Duration  459ms (transform 77ms, setup 0ms, import 103ms, tests 5ms, environment 0ms)

